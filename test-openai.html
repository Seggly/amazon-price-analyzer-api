<!DOCTYPE html>
<html>
<head>
    <title>OpenAI Text Generation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .input-section {
            margin-bottom: 20px;
        }
        .result-section {
            background: #f3f3f3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .text-block {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            overflow: auto;
            max-height: 500px;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>OpenAI Text Generation Test</h1>
    
    <div class="input-section">
        <button onclick="testGenerateText()">Test Text Generation</button>
    </div>

    <div class="result-section">
        <h3>Generated Text:</h3>
        <div class="text-block" id="header"></div>
        <div class="text-block" id="firstPhrase"></div>
        <div class="text-block" id="secondPhrase"></div>
        <div class="text-block" id="thirdPhrase"></div>
    </div>

    <div>
        <h3>Debug Output:</h3>
        <pre id="debug"></pre>
    </div>

    <script>
        async function testGenerateText() {
            clearResults();
            setLoading(true);

            try {
                // Sample data matching your backend structure
                const sampleData = {
                    analysis: {
                        new: {
                            meterScore: {
                                score: 75
                            },
                            currentPriceContext: {
                                currentPrice: 41.95,
                                usualPrice: {
                                    price: 41.95,
                                    percentageOfTime: 76
                                },
                                lowestPrice: 35.66,
                                highestPrice: 41.95
                            },
                            volatilityMetrics: {
                                totalChanges: 5
                            }
                        }
                    }
                };

                logDebug('Sending request with data:', sampleData);

                const response = await fetch('https://amazon-price-analyzer-api.vercel.app/api/generate-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sampleData)
                });

                logDebug('Response status:', response.status);
                
                const data = await response.json();
                logDebug('Response data:', data);

                if (data.success) {
                    displayResults(data.text);
                } else {
                    throw new Error(data.error || 'Failed to generate text');
                }
            } catch (error) {
                logDebug('Error:', error);
                showError(error.message);
            } finally {
                setLoading(false);
            }
        }

        function displayResults(text) {
            document.getElementById('header').textContent = text.header;
            document.getElementById('firstPhrase').textContent = text.firstPhrase;
            document.getElementById('secondPhrase').textContent = text.secondPhrase;
            document.getElementById('thirdPhrase').textContent = text.thirdPhrase;
        }

        function clearResults() {
            document.getElementById('header').textContent = '';
            document.getElementById('firstPhrase').textContent = '';
            document.getElementById('secondPhrase').textContent = '';
            document.getElementById('thirdPhrase').textContent = '';
            document.getElementById('debug').textContent = '';
        }

        function setLoading(isLoading) {
            const loadingText = 'Loading...';
            if (isLoading) {
                document.getElementById('header').textContent = loadingText;
                document.getElementById('firstPhrase').textContent = loadingText;
                document.getElementById('secondPhrase').textContent = loadingText;
                document.getElementById('thirdPhrase').textContent = loadingText;
            }
        }

        function showError(message) {
            document.getElementById('header').innerHTML = `<span class="error">Error: ${message}</span>`;
        }

        function logDebug(label, data) {
            const debug = document.getElementById('debug');
            const timestamp = new Date().toISOString();
            debug.textContent += `\n[${timestamp}] ${label} ${data ? JSON.stringify(data, null, 2) : ''}`;
            debug.scrollTop = debug.scrollHeight;
        }
    </script>
</body>
</html>